<!--
 *Copyright 2018 T Mobile, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); You may not use
 * this file except in compliance with the License. A copy of the License is located at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * or in the "license" file accompanying this file. This file is distributed on
 * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or
 * implied. See the License for the specific language governing permissions and
 * limitations under the License.
 -->

<div class="overlay-vertical-center">
    <div class="overlay-innerwrap">
        <div class="page-wrapper flex flex-col">
            <header class="page-header flex flex-align-center no-shrink flex-between">
                <div (click)="closeVulnModel()" class="goBack flex flex-align-center">
                    <img class="back-arrow" src="../assets/icons/BackArrow.svg" /> Back
                </div>
                <div class="flex flex-align-center white light-font">
                    <div class="filter-txt">Severity:</div>
                    <div
                        class="checkbox-wrap flex flex-align-center"
                        *ngFor="let cb of cbModel; let i = index"
                    >
                        <label
                            (click)="cbModel[i] = !cbModel[i]"
                            class="flex flex-align-center"
                            [class.active]="cbModel[i]"
                        >
                            <div class="checkbox relative">
                                <div class="absolute tick-mark" *ngIf="cbModel[i]">
                                    <img src="../assets/icons/white-tick.svg" />
                                </div>
                            </div>
                            <div class="cb-text">S{{ i + 3 }}</div>
                        </label>
                    </div>
                    <div
                        class="apply-btn"
                        [class.disabled]="checkIfEqual()"
                        (click)="updateSeverity()"
                    >
                        Apply
                    </div>
                </div>
            </header>
            <section
                class="vuln-report-container flex flex-col relative"
                [class.overflow-hidden]="openWorkflow"
                [class.info-present]="infoActive"
            >
                <div class="main-wrap">
                    <div
                        class="absolute error-occurred"
                        *ngIf="hideDistribution && hideTrend && hideStats && hideTables"
                    >
                        Oops! We're unable to fetch your data.
                    </div>
                    <div
                        class="widget vuln-report-header flex flex-align-center flex-col flex-center relative no-shrink"
                    >
                        <div class="flex flex-align-center side-padding flex-center line-height">
                            <div class="page-header-txt">Vulnerability Summary by Org:</div>
                            <div class="page-header-txt capitalize bold">{{ agDetails.name }}</div>
                            <a (click)="changeAssetGroup()">
                                <div
                                    class="ag-icon-wrap pointer flex flex-align-center flex-center"
                                >
                                    <img src="../assets/icons/asset-group-magenta.svg" />
                                </div>
                            </a>
                        </div>
                        <div class="flex flex-align-center head-outer">
                            <div class="head-wrap flex flex-align-center" *ngIf="severityFilter">
                                <div class="head-txt">Filtered by:</div>
                                <div>{{ severityFilter }}</div>
                            </div>
                            <div class="head-wrap flex flex-align-center">
                                <div class="head-txt">Updated:</div>
                                <div>{{ today.month }}/{{ today.day }}/{{ today.year }}</div>
                            </div>
                        </div>

                        <img
                            (click)="downloadReport()"
                            class="download-img absolute"
                            (mouseenter)="onMouseEnterPrintIcon()"
                            (mouseleave)="onMouseLeavePrintIcon()"
                            src="../assets/icons/print.svg"
                        />
                        <img
                            (click)="openWorkflow = true"
                            class="download-imgicon absolute"
                            src="../assets/icons/Info-inactive.svg"
                        />
                        <img
                            *ngIf="this.logoName"
                            class="pacman-img absolute"
                            src="../assets/icons/{{ this.logoName }}"
                        />
                        <div [class.active]="printInfo" class="print-info absolute">
                            <div class="print-info-heading">
                                For best print results, use these settings:
                            </div>
                            <ul class="print-info-list">
                                <li>
                                    <span class="label">Layout: </span>
                                    <span class="value">Portrait</span>
                                </li>
                                <li>
                                    <span class="label">Paper size: </span>
                                    <span class="value">A4</span>
                                </li>
                                <li>
                                    <span class="label">Margin: </span>
                                    <span class="value">None</span>
                                </li>
                                <li>
                                    <span class="label">Scale: </span>
                                    <span class="value">100%</span>
                                </li>
                                <li>
                                    <span class="label">Headers & Footers: </span>
                                    <span class="value">Unchecked</span>
                                </li>
                                <li>
                                    <span class="label">Background graphics: </span>
                                    <span class="value">Checked</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="widget vuln-report-summary" *ngIf="!hideStats">
                        <app-vuln-report-stats
                            (emitError)="hideStats = true"
                            [filter]="filterObj"
                        ></app-vuln-report-stats>
                    </div>
                    <div class="widget vuln-dist-wrap" *ngIf="!hideDistribution">
                        <div class="widget-header-wrap flex flex-align-center">
                            <div class="widget-header-txt">Vulnerability Distribution</div>
                            <div class="right-line relative">
                                <div class="circle-attached absolute"></div>
                            </div>
                            <div class="widget-header-desc">
                                Percentages below are calculated using total occurrences.
                            </div>
                        </div>
                        <div class="vul-report-distribution relative">
                            <app-vuln-report-distribution
                                [filter]="filterObj"
                                (emitFailureError)="hideDistribution = true"
                            ></app-vuln-report-distribution>
                        </div>
                    </div>
                    <div class="widget vuln-report-trend" *ngIf="!hideTrend">
                        <div class="widget-header-wrap flex flex-align-center">
                            <div class="widget-header-txt">Vulnerability Trend</div>
                            <div class="right-line relative">
                                <div class="circle-attached absolute"></div>
                            </div>
                            <div class="widget-header-desc">
                                The trend of remediation vs. newly discovered vulnerabilities.
                                Remediation velocity can be understood as a downward trend for open
                                issues. New issues can be understood as adding to the backlog of
                                remediation work that must be done.
                            </div>
                        </div>
                        <app-vuln-report-trend
                            (infoState)="catchInfoState($event)"
                            id="vulnerability-trend"
                            [filter]="filterObj"
                            (emitError)="hideTrend = true"
                        ></app-vuln-report-trend>
                    </div>
                    <div class="widget vuln-report-actions relative" *ngIf="!hideTables">
                        <app-vuln-report-tables
                            (emitError)="hideTables = true"
                            [filter]="filterObj"
                        ></app-vuln-report-tables>
                    </div>
                </div>
                <div [class.hide-workflow]="!openWorkflow" class="vuln-report-workflow">
                    <app-vuln-report-workflow
                        (closeWf)="openWorkflow = false"
                    ></app-vuln-report-workflow>
                </div>
            </section>
        </div>
    </div>
</div>
